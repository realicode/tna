<title>组织机构</title>
<link rel="stylesheet" xmlns:th="http://www.thymeleaf.org"
      th:href="@{/smartadmin/css/ztree/zTreeStyle.css}"
      href="../../../../static/smartadmin/css/ztree/zTreeStyle.css"/>
<!-- Bread crumb is created dynamically -->
<!-- row -->
<div class="row">
    <!-- col -->
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
        <h1 class="page-title txt-color-blueDark">

            <!-- PAGE HEADER -->
            <i class="fa-fw fa fa-home"></i>
            检查项管理
			<span>>
				新增检查任务
			</span>
        </h1>
    </div>
    <!-- end col -->

    <!-- right side of the page with the sparkline graphs -->
    <!-- col -->
    <!-- end col -->

</div>
<!-- end row -->

<!--
	The ID "widget-grid" will start to initialize all widgets below 
	You do not need to use widgets if you dont want to. Simply remove 
	the <section></section> and you can use wells or panels instead 
	-->

<!-- widget grid -->
<section id="widget-grid" class="">

    <!-- row -->
    <div class="row">

        <!-- NEW WIDGET START -->
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget" id="wid-id-0">
                <!-- widget options:
                    usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">

                    data-widget-colorbutton="false"
                    data-widget-editbutton="false"
                    data-widget-togglebutton="false"
                    data-widget-deletebutton="false"
                    data-widget-fullscreenbutton="false"
                    data-widget-custombutton="false"
                    data-widget-collapsed="true"
                    data-widget-sortable="false"

                -->
                <header>
                    <span class="widget-icon"> <i class="fa fa-arrow-down"></i> </span>
                    <h2><strong>选择检查项11</strong></h2>
                    <div class="widget-toolbar">

                        <div class="btn-group">
                            <button class="btn dropdown-toggle btn-xs btn-primary" data-toggle="dropdown">
                                点击生成检查任务 <i class="fa fa-caret-down"></i>
                            </button>
                            <ul class="dropdown-menu pull-right">
                                <li>
                                    <a href="javascript:void(0);">为下级工作单位生成检查任务</a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);">为企业生成检查任务</a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);">保存为模版</a>
                                </li>
                            </ul>
                        </div>
                    </div>

                </header>

                <!-- widget div-->
                <div>

                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                        <input class="form-control" type="text">
                    </div>
                    <!-- end widget edit box -->

                    <!-- widget content -->
                    <div class="widget-body">
                        <div class="row">

                            <!-- a blank row to get started -->
                            <div class="col-sm-12">
                                <!-- your contents here -->
                                <div class="zTreeDemoBackground left">
                                    <ul id="treeDemo" class="ztree"></ul>
                                </div>
                            </div>
                            <div class="col-sm-12">
                                <!-- your contents here -->
                                <div class="right">
                                    <ul class="info">
                                        <li class="title"><h2>1、getNodeByParam / getNodesByParam / getNodesByParamFuzzy
                                            方法操作说明</h2>
                                            <ul class="list">
                                                <li class="highlight_red">使用 zTreeObj.getNodeByParam / getNodesByParam /
                                                    getNodesByParamFuzzy / getNodeByTId 方法，详细请参见 API 文档中的相关内容
                                                </li>
                                                <li><p>搜索试试看：<br/>
                                                    属性值( value )：<input type="text" id="key" value=""
                                                                        class="empty"/><br/>
                                                    属性( key )：<input type="radio" id="name" name="keyType"
                                                                     class="radio first"
                                                                     checked/><span>name (string)</span><br/>
                                                    <input type="radio" id="level" name="keyType" class="radio"
                                                           style="margin-left:68px;"/><span>level (number) ... 根节点 level = 0</span><br/>
                                                    <input type="radio" id="id" name="keyType" class="radio"
                                                           style="margin-left:68px;"/><span>id (number)</span><br/>
                                                    方法：<input type="radio" id="getNodeByParam" name="funType"
                                                              class="radio first"/><span>getNodeByParam</span><br/>
                                                    <input type="radio" id="getNodesByParam" name="funType"
                                                           class="radio" style="margin-left:36px;"/><span>getNodesByParam</span><br/>
                                                    <input type="radio" id="getNodesByParamFuzzy" name="funType"
                                                           class="radio" style="margin-left:36px;" checked/><span>getNodesByParamFuzzy (only string)</span><br/>
                                                    <input type="radio" id="getNodesByFilter" name="funType"
                                                           class="radio" style="margin-left:36px;"/><span>getNodesByFilter (参考本页源码中 function filter)</span><br/>
                                                </p>
                                                </li>
                                            </ul>
                                        </li>

                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- this is what the user will see -->

                    </div>
                    <!-- end widget content -->

                </div>
                <!-- end widget div -->

            </div>
            <!-- end widget -->

        </article>
        <!-- WIDGET END -->

    </div>

    <!-- end row -->

    <!-- row -->
    <div class="row">

        <!-- NEW WIDGET START -->
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <table id="jqgrid"></table>
            <div id="pjqgrid"></div>

            <br>
            <a href="javascript:void(0)" id="m1">Get Selected id's</a><br>
            <a href="javascript:void(0)" id="m1s">Select(Unselect) row 13</a>

        </article>
        <!-- WIDGET END -->

    </div>


    <!-- end row -->

</section>
<!-- end widget grid -->

<script type="text/javascript">

    /* DO NOT REMOVE : GLOBAL FUNCTIONS!
     *
     * pageSetUp(); WILL CALL THE FOLLOWING FUNCTIONS
     *
     * // activate tooltips
     * $("[rel=tooltip]").tooltip();
     *
     * // activate popovers
     * $("[rel=popover]").popover();
     *
     * // activate popovers with hover states
     * $("[rel=popover-hover]").popover({ trigger: "hover" });
     *
     * // activate inline charts
     * runAllCharts();
     *
     * // setup widgets
     * setup_widgets_desktop();
     *
     * // run form elements
     * runAllForms();
     *
     ********************************
     *
     * pageSetUp() is needed whenever you load a page.
     * It initializes and checks for all basic elements of the page
     * and makes rendering easier.
     *
     */

    pageSetUp();

    /*
     * ALL PAGE RELATED SCRIPTS CAN GO BELOW HERE
     * eg alert("my home function");
     *
     * var pagefunction = function() {
     *   ...
     * }
     * loadScript("js/plugin/_PLUGIN_NAME_.js", pagefunction);
     *
     * TO LOAD A SCRIPT:
     * var pagefunction = function (){
     *  loadScript(".../plugin.js", run_after_loaded);
     * }
     *
     * OR you can load chain scripts by doing
     *
     * loadScript(".../plugin.js", function(){
     * 	 loadScript("../plugin.js", function(){
     * 	   ...
     *   })
     * });
     */




    // pagefunction

    var pagefunction = function () {

        var setting = {
            view: {
                fontCss: {color: "red"}
            },
            check: {
                enable: true,
                chkboxType: {"Y": "ps", "N": "ps"}
            },
            data: {
                simpleData: {
                    enable: true,
                }
            }
        };

        var settingProduct = {
            check: {
                enable: true,
                chkboxType: {"Y": "ps", "N": "ps"}
            },
            async: {
                enable: true, // 设置 zTree是否开启异步加载模式  加载全部信息
                url: "http://localhost:48080/tna/sa/checkitem/api/top", // Ajax 获取数据的 URL 地址
                autoParam: ["id"],   // 异步加载时自动提交父节点属性的参数,假设父节点 node = {id:1, name:"test"}，异步加载时，提交参数 zId=1
                type: "GET"
            },
            data: {
                key: {
                    name: "itemContent"
                },
                simpleData: {
                    enable: true,
                    idKey: "id", // id编号命名 默认
                    pIdKey: "parentid", // 父id编号命名 默认
                    rootPId: 0 // 用于修正根节点父节点数据，即 pIdKey 指定的属性值
                }
            }
        };

        var zNodes = [
            {id: 1, pId: 0, name: "检查项根目录", open: true},
            {id: 11, pId: 1, name: "质量体系"},
            {id: 111, pId: 11, name: "检查项1:评定内容:评分标准:分值:检查项目(检查体系文件)"},
            {id: 112, pId: 11, name: "叶子节点112"},
            {id: 113, pId: 11, name: "叶子节点113"},
            {id: 114, pId: 11, name: "叶子节点114"},
            {id: 12, pId: 1, name: "文件管理"},
            {id: 121, pId: 12, name: "叶子节点121"},
            {id: 122, pId: 12, name: "叶子节点122"},
            {id: 123, pId: 12, name: "叶子节点123"},
            {id: 124, pId: 12, name: "叶子节点124"},
            {id: 13, pId: 1, name: "生产管理", isParent: true},
            {id: 14, pId: 1, name: "质量管理", isParent: true}
        ];
        //$.fn.zTree.init($("#treeDemo"), setting, zNodes);

        function focusKey(e) {
            if (key.hasClass("empty")) {
                key.removeClass("empty");
            }
        }

        function blurKey(e) {
            if (key.get(0).value === "") {
                key.addClass("empty");
            }
        }

        var lastValue = "", nodeList = [], fontCss = {};

        function clickRadio(e) {
            lastValue = "";
            searchNode(e);
        }

        function searchNode(e) {
            var zTree = $.fn.zTree.getZTreeObj("treeDemo");
            if (!$("#getNodesByFilter").attr("checked")) {
                var value = $.trim(key.get(0).value);
                var keyType = "";
                if ($("#name").attr("checked")) {
                    keyType = "name";
                } else if ($("#level").attr("checked")) {
                    keyType = "level";
                    value = parseInt(value);
                } else if ($("#id").attr("checked")) {
                    keyType = "id";
                    value = parseInt(value);
                }
                if (key.hasClass("empty")) {
                    value = "";
                }
                if (lastValue === value) return;
                lastValue = value;
                if (value === "") return;
                updateNodes(false);

                if ($("#getNodeByParam").attr("checked")) {
                    var node = zTree.getNodeByParam(keyType, value);
                    if (node === null) {
                        nodeList = [];
                    } else {
                        nodeList = [node];
                    }
                } else if ($("#getNodesByParam").attr("checked")) {
                    nodeList = zTree.getNodesByParam(keyType, value);
                } else if ($("#getNodesByParamFuzzy").attr("checked")) {
                    nodeList = zTree.getNodesByParamFuzzy(keyType, value);
                }
            } else {
                updateNodes(false);
                nodeList = zTree.getNodesByFilter(filter);
            }
            updateNodes(true);

        }

        function updateNodes(highlight) {
            var zTree = $.fn.zTree.getZTreeObj("treeDemo");
            for (var i = 0, l = nodeList.length; i < l; i++) {
                nodeList[i].highlight = highlight;
                zTree.updateNode(nodeList[i]);
            }
        }

        function getFontCss(treeId, treeNode) {
            return (!!treeNode.highlight) ? {color: "#A60000", "font-weight": "bold"} : {
                color: "#333",
                "font-weight": "normal"
            };
        }

        function filter(node) {
            return !node.isParent && node.isFirstNode;
        }

        var key;
        $.fn.zTree.init($("#treeDemo"), settingProduct);
        key = $("#key");
        key.bind("focus", focusKey)
                .bind("blur", blurKey)
                .bind("propertychange", searchNode)
                .bind("input", searchNode);
        $("#name").bind("change", clickRadio);
        $("#level").bind("change", clickRadio);
        $("#id").bind("change", clickRadio);
        $("#getNodeByParam").bind("change", clickRadio);
        $("#getNodesByParam").bind("change", clickRadio);
        $("#getNodesByParamFuzzy").bind("change", clickRadio);
        $("#getNodesByFilter").bind("change", clickRadio);

        loadScript("/tna/smartadmin/js/plugin/jqgrid/jquery.jqGrid.min.js", run_jqgrid_function);

        function run_jqgrid_function() {


            var jqgrid_data = [{
                id: "1",
                date: "2007-10-01",
                name: "test",
                note: "note",
                amount: "测试人员1",
                tax: "10",
                total: "已完成"
            }, {
                id: "2",
                date: "2016-3-02",
                name: "test2",
                note: "note2",
                amount: "测试人员2",
                tax: "20",
                total: "执行中"
            }, {
                id: "3",
                date: "2016-03-15",
                name: "test3",
                note: "note3",
                amount: "测试人员3",
                tax: "30",
                total: "未开始执行"
            }];

            jQuery("#jqgrid").jqGrid({
                data: jqgrid_data,
                datatype: "local",
                height: 'auto',
                colNames: ['操作', '序号', '检查项名称', '生成日期', '生成人员', '检查项数量', '状态', '备注'],
                colModel: [
                    {name: 'act', index: 'act', sortable: false},
                    {name: 'id', index: 'id'},
                    {name: 'name', index: 'name', editable: true},
                    {name: 'date', index: 'date', editable: true},
                    {name: 'amount', index: 'amount', align: "right", editable: true},
                    {name: 'tax', index: 'tax', align: "right", editable: true},
                    {name: 'total', index: 'total', align: "right", editable: true},
                    {name: 'note', index: 'note', sortable: false, editable: true}],
                rowNum: 10,
                rowList: [10, 20, 30],
                pager: '#pjqgrid',
                sortname: 'id',
                toolbarfilter: true,
                viewrecords: true,
                sortorder: "asc",
                gridComplete: function () {
                    var ids = jQuery("#jqgrid").jqGrid('getDataIDs');
                    for (var i = 0; i < ids.length; i++) {
                        var cl = ids[i];
                        be = "<button class='btn btn-xs btn-default' data-original-title='Edit Row' onclick=\"jQuery('#jqgrid').editRow('" + cl + "');\"><i class='fa fa-pencil'></i></button>";
                        se = "<button class='btn btn-xs btn-default' data-original-title='Save Row' onclick=\"jQuery('#jqgrid').saveRow('" + cl + "');\"><i class='fa fa-save'></i></button>";
                        ca = "<button class='btn btn-xs btn-default' data-original-title='Cancel' onclick=\"jQuery('#jqgrid').restoreRow('" + cl + "');\"><i class='fa fa-times'></i></button>";
                        //ce = "<button class='btn btn-xs btn-default' onclick=\"jQuery('#jqgrid').restoreRow('"+cl+"');\"><i class='fa fa-times'></i></button>";
                        //jQuery("#jqgrid").jqGrid('setRowData',ids[i],{act:be+se+ce});
                        jQuery("#jqgrid").jqGrid('setRowData', ids[i], {act: be + se + ca});
                    }
                },
                editurl: "dummy.html",
                caption: "已有检查项列表(模版)",
                multiselect: true,
                autowidth: true,

            });
            jQuery("#jqgrid").jqGrid('navGrid', "#pjqgrid", {
                edit: false,
                add: false,
                del: true
            });
            jQuery("#jqgrid").jqGrid('inlineNav', "#pjqgrid");
            /* Add tooltips */
            $('.navtable .ui-pg-button').tooltip({
                container: 'body'
            });

            jQuery("#m1").click(function () {
                var s;
                s = jQuery("#jqgrid").jqGrid('getGridParam', 'selarrrow');
                alert(s);
            });
            jQuery("#m1s").click(function () {
                jQuery("#jqgrid").jqGrid('setSelection', "13");
            });

            // remove classes
            $(".ui-jqgrid").removeClass("ui-widget ui-widget-content");
            $(".ui-jqgrid-view").children().removeClass("ui-widget-header ui-state-default");
            $(".ui-jqgrid-labels, .ui-search-toolbar").children().removeClass("ui-state-default ui-th-column ui-th-ltr");
            $(".ui-jqgrid-pager").removeClass("ui-state-default");
            $(".ui-jqgrid").removeClass("ui-widget-content");

            // add classes
            $(".ui-jqgrid-htable").addClass("table table-bordered table-hover");
            $(".ui-jqgrid-btable").addClass("table table-bordered table-striped");


            $(".ui-pg-div").removeClass().addClass("btn btn-sm btn-primary");
            $(".ui-icon.ui-icon-plus").removeClass().addClass("fa fa-plus");
            $(".ui-icon.ui-icon-pencil").removeClass().addClass("fa fa-pencil");
            $(".ui-icon.ui-icon-trash").removeClass().addClass("fa fa-trash-o");
            $(".ui-icon.ui-icon-search").removeClass().addClass("fa fa-search");
            $(".ui-icon.ui-icon-refresh").removeClass().addClass("fa fa-refresh");
            $(".ui-icon.ui-icon-disk").removeClass().addClass("fa fa-save").parent(".btn-primary").removeClass("btn-primary").addClass("btn-success");
            $(".ui-icon.ui-icon-cancel").removeClass().addClass("fa fa-times").parent(".btn-primary").removeClass("btn-primary").addClass("btn-danger");

            $(".ui-icon.ui-icon-seek-prev").wrap("<div class='btn btn-sm btn-default'></div>");
            $(".ui-icon.ui-icon-seek-prev").removeClass().addClass("fa fa-backward");

            $(".ui-icon.ui-icon-seek-first").wrap("<div class='btn btn-sm btn-default'></div>");
            $(".ui-icon.ui-icon-seek-first").removeClass().addClass("fa fa-fast-backward");

            $(".ui-icon.ui-icon-seek-next").wrap("<div class='btn btn-sm btn-default'></div>");
            $(".ui-icon.ui-icon-seek-next").removeClass().addClass("fa fa-forward");

            $(".ui-icon.ui-icon-seek-end").wrap("<div class='btn btn-sm btn-default'></div>");
            $(".ui-icon.ui-icon-seek-end").removeClass().addClass("fa fa-fast-forward");


            // update buttons

            $(window).on('resize.jqGrid', function () {
                jQuery("#jqgrid").jqGrid('setGridWidth', $("#content").width());
            })


        };


    };
    //loadScript("/tna/smartadmin/js/plugin/jqgrid/jquery.jqGrid.min.js", run_jqgrid_function);

    // end pagefunction

    // destroy generated instances
    // pagedestroy is called automatically before loading a new page
    // only usable in AJAX version!

    var pagedestroy = function () {

        /*
         Example below:

         $("#calednar").fullCalendar( 'destroy' );
         if (debugState){
         root.console.log("✔ Calendar destroyed");
         }

         For common instances, such as Jarviswidgets, Google maps, and Datatables, are automatically destroyed through the app.js loadURL mechanic

         */
    };

    // end destroy

    // run pagefunction
    //pagefunction();


    loadScript("/tna/smartadmin/js/ztree/jquery.ztree.core.min.js", function () {
        loadScript("/tna/smartadmin/js/ztree/jquery.ztree.excheck.min.js", function () {
            loadScript("/tna/smartadmin/js/plugin/jqgrid/grid.locale-en.min.js", pagefunction)
        });
    });
</script>
